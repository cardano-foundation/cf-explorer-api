package org.cardanofoundation.explorer.api.repository.ledgersync;

import java.math.BigInteger;
import java.util.List;

import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;

import org.cardanofoundation.explorer.api.projection.TxGraphProjection;
import org.cardanofoundation.explorer.common.entity.ledgersync.TxChart;

public interface TxChartRepository extends JpaRepository<TxChart, Long> {

  @Query(
      "SELECT SUM(tx.txSimple) AS simpleTransactions,"
          + " SUM(tx.txWithMetadataWithoutSc) AS metadata,"
          + "SUM(tx.txWithSc) AS smartContract, "
          + "tx.hour AS time FROM TxChart tx "
          + "WHERE tx.hour in :hours "
          + "GROUP BY tx.hour "
          + "ORDER BY tx.hour ASC ")
  List<TxGraphProjection> getTransactionGraphByHour(@Param("hours") List<BigInteger> hours);

  @Query(
      "SELECT SUM(tx.txSimple) AS simpleTransactions,"
          + " SUM(tx.txWithMetadataWithoutSc) AS metadata ,"
          + "SUM(tx.txWithSc) AS smartContract, "
          + "tx.day AS time FROM TxChart tx "
          + "WHERE tx.day in :day "
          + "GROUP BY tx.day "
          + "ORDER BY tx.day ASC ")
  List<TxGraphProjection> getTransactionGraphByDay(@Param("day") List<BigInteger> day);

  @Query(
      "SELECT SUM(tx.txSimple) AS simpleTransactions,"
          + " SUM(tx.txWithMetadataWithoutSc) AS  metadata,"
          + "SUM(tx.txWithSc) AS smartContract, "
          + "tx.day AS time FROM TxChart tx "
          + "WHERE tx.day >= :day "
          + "GROUP BY tx.day "
          + "ORDER BY tx.day ASC")
  List<TxGraphProjection> getTransactionGraphDayGreaterThan(@Param("day") BigInteger day);

  @Query(
      "SELECT SUM(tx.txSimple) AS simpleTransactions,"
          + " SUM(tx.txWithMetadataWithoutSc) AS  metadata,"
          + "SUM(tx.txWithSc) AS smartContract, "
          + "tx.month AS time FROM TxChart tx "
          + "WHERE :day is null or (tx.day >= :day) "
          + "GROUP BY tx.month "
          + "ORDER BY tx.month ASC")
  List<TxGraphProjection> getTransactionGraphMonthGreaterThan(@Param("day") BigInteger day);
}
